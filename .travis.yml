language: java
install: true
jdk:
- openjdk8
- openjdk11
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- name: build
- name: snapshot
  if: branch = master
- name: release
  if: branch = release
jobs:
  include:
  - stage: build
    script: "./gradlew build"
  - stage: snapshot
    script: "./gradlew publish -x test -Dsnapshot=true -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
  - stage: release
    script: "./gradlew publish -x test -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
deploy:
  provider: releases
  api_key:
    secure: hYXtHhNRm///9qKtg4n7uz4QKFlT6IJ5gfzUeI/fk/QdBuIkVnqFiFMngoC3KeT0xgcVKXSnIxDm/yDbXicNQBAkWWQ9HrSMPFSm0f13mc1JqTZawqhwGQgsY3DxhISflddVtCdoBlDQwlTJER5pmTvXHToDTGls/F5MWF0b+N1XJ7yY7tn9tTtB1AfB6yQwUjHbZ7drVnAdZzM464QTUsqoo0/d5rg8rmMZswVgaJA4c/sPIOhYMeuv6fIoGpbEgAh3Livm89QpW8s6+z/KNrecxRI0aGvDLyv/lSuXYPn4FPZAlqhwLZBvI5qaf0ZuthK+7meF8teB1VYCkO/pB7z/eo3Dub0I1c1pfvo9lU4nihyheDYCY3j0WjF5mbBdikfOijuNIBUIHW99QHEOrbPMYniTw+CPXqUzcrKmK2RDSBXD2rNiEhjr5iv8prik1RGjUM7W988nz42GmnHpFG5PZXrZou96tAgnljNglJnSXLZH9u0Z4YDvYLIFVLawYrUUjsBj97vDUq1eTdMQYDgWcxdFsrZwtjPdG+UKWjyw5ffsyBP9wQBhED1KwGB+tBz8smiH4cVJ9LSRN+OIbT82ZweLhOjWTcfxS7t85P0bqCIppTXoWdnw6jCoQxyJTYTp1NFpXJYJLv69gZP5Q0M3GCPZKzsMiOZ3vVc3dq4=
  file_glob: true
  file: build/libs/*
  skip_cleanup: true
  on:
    repo: upbcuk/upb.crypto.clarc
    branch: release