language: java
install: true
jdk:
- openjdk8
- openjdk11
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- name: build
- name: snapshot
  if: branch = master
- name: release
  if: branch = release
jobs:
  include:
  - stage: build
    script: "./gradlew build"
  - stage: snapshot
    script: "./gradlew publish -x test -Dsnapshot=true -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
  - stage: release
    script: "./gradlew publish -x test -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
deploy:
  provider: releases
  api_key:
    secure: E+NE3riBnAFigrvfyd92epsvMAnKSuMcHuly4lNEdY+Ue6jfj67rLknpVkhIMODV/0yPxFBtR6gbJSronEql8ev9PMFWVv7CrRHIbWiBpzSNY7nIN/y4o+33MDZ75qt3eASIhmDs73myWOcStp1Ym6PZpAeYpWs5XteQmngZGMv8gtWX17cClBOJPgLUFlJcAi12CM8BpiJPp2OPVcpKtJZvlqK2zTD26MaYZVBHr0/JRaSA3HGQokUkHRmpSi0h4aWUYARy/uIfmqiOYDhNVaNch0xwyHXVQSmDGKlSNN1qqEiHwYJXbaHixNuUsJS4ZuhOs0Lun3TSIgzyqSZgNVd5vKeBpyokZZnpd7nzoSuPCTDOCDsW/H3bN8ovpXs49qvM8k63ANKeS5uMiFPvbvUlkWqHm4kQNqHOkvEilXnXC97PX9hedWeqZ5YRxu7lIz2OLpphfmGlaJUYh/vYwscmJ9cpM++lHyswk7iHF2FZfZyvuQVD+VQwPWgbZgfjjvp1WoWbC7y+6He1nE0iWmXeSFpq8aMilJ8WiJ0oOLFOKz+Yn+sg/f7ASn4Hhfd6myhy8MjSbBbM+zbcJAi55/wSa29IsGBiqSm09pH5ukS0j0FIw8WLrxiqK/Y7ae4dEYgi4fB78NtYh5jOprlMwck01om/UWtS0OBS6+ywySA=
  file_glob: true
  file: build/libs/*
  skip_cleanup: true
  on:
    repo: upbcuk/upb.crypto.clarc
    branch: release